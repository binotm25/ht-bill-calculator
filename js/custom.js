function _(t){return document.getElementById(t)}function restrict(t){var o=_(t),e=new RegExp;e="dtr"==t?/[^a-z0-9-]/gi:"load"==t?/[^0-9.]/gi:/[^a-z ]/gi,o.value=o.value.replace(e,"")}function daysInMonth(t,o){return new Date(o,t,0).getDate()}function alert_user(t){""!=$("#name").val()&&null!=$("#name").val()||$(this).css("outline","red")}function getMonthNames(t){var o=moment().set({month:t-1}).format("MMMM");return o}function getDetails(t,o,e){var a=(o.substring(8,10),o.substring(5,7)),n=o.substring(0,4),r=(e.substring(8,10),e.substring(5,7),e.substring(0,4)),s=moment(o),i=moment(e),d=i.diff(s,"months");$.ajax({type:"POST",url:"index.php",data:{val:t,start:o,end:e,monthDiff:d},success:function(t){var o=[];if($("#hour_masing").html(""),r!=n){o=t,$("#hour_masing").append('<li style="list-style:none;">The Total no. of Hours of Power Supply list :</li>');var e=$.parseJSON(t);"object"==typeof e&&$.each(e,function(t,o){$.each(o,function(t,o){""==o||null==o?$("#hour_masing").append('<li data-value="'+t+'" class="bg-danger form-list">'+moment(t,"MM").format("MMMM")+" = This Feeder doesn't have any data for this month.</li>"):$("#hour_masing").append('<li data-value="'+t+'" class="bg-success form-list">'+moment(t,"MM").format("MMMM")+" = "+(730-o)+" hours</li>")})})}else if(d>0){o=t;var e=$.parseJSON(t);"object"==typeof e&&($("#hour_masing").append('<li style="list-style:none;">The Total no. of Hours of Power Supply list :</li>'),$.each(e,function(t,e){$.each(e,function(t,e){o[t]=e,""==e||null==e?$("#hour_masing").append('<li data-value="'+t+'" class="bg-danger form-list">'+moment(t,"MM").format("MMMM")+" = This Feeder doesn't have any data for this month.</li>"):$("#hour_masing").append('<li data-value="'+t+'" class="bg-success form-list">'+moment(t,"MM").format("MMMM")+" = "+(730-e)+" hours</li>")})}))}else 0==d&&(o=t,""==t?$("#hour_masing").append('<li data-value="'+a+'" class="bg-danger form-list">'+moment(a,"MM").format("MMMM")+" = This Feeder doesn't have any data for this month.</li>"):$("#hour_masing").append('<li data-value="'+a+'" class="bg-success form-list">The Total no. of Hours of Power Supply for the month of '+moment(a,"MM").format("MMMM")+" = "+(730-t)+" hours</li>"));window.i=o}})}var days_no;$(function(){window.startMonth=moment().startOf("month").subtract(1,"months").format("DD/MM/YYYY"),window.endMonth=moment().endOf("month").subtract(1,"months").format("DD/MM/YYYY");var t=window.startMonth,o=(window.endMonth,moment().startOf("month").subtract(1,"days").format("DD/MM/YYYY"));$('input[name="month"]').daterangepicker({showDropdowns:!0,autoApply:!0,locale:{format:"DD/MM/YYYY",separator:" - ",applyLabel:"Apply",cancelLabel:"Cancel",fromLabel:"From",toLabel:"To",customRangeLabel:"Custom",daysOfWeek:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],firstDay:1},linkedCalendars:!1,minDate:"01/01/2016",maxDate:o,startDate:t,endDate:window.end},function(t,o,e){window.start=t.format("DD/MM/YYYY"),window.end=o.format("DD/MM/YYYY");var a=moment(o).diff(moment(t),"days");window.days_no=a+1;var a=moment(o).diff(moment(t),"months");window.month_no=a,$("#date_diff").text("Total number of days for this period is "+window.days_no),$("#date_takpa").show(200);var n=$("#feeder").val();null!=n&&getDetails(n,t.format("YYYY-MM-DD"),o.format("YYYY-MM-DD"))})});var start=moment().startOf("month").subtract(1,"months").format("DD/MM/YYYY"),startMonth=moment().startOf("month").subtract(1,"months").format("MM"),end=moment().startOf("month").subtract(1,"days").format("DD/MM/YYYY"),a=moment(start,"DD/MM/YYYY"),b=moment(end,"DD/MM/YYYY");window.start=start,window.end=end;var diff=b.diff(a,"days");window.days_no=diff+1;var diff_month=b.diff(a,"months");window.month_no=diff_month,$("#date_diff").text("Total number of days for this period is "+(diff+1)),$("#date_takpa").delay(1e3).show(300),$(document).ready(function(){var t=window.innerWidth;990>t?($(".choose").remove(),$("#dtr").removeAttr("style size").prepend('<option class="form-control">Select the DTR Capacity</option>'),$("#sub").removeAttr("style size").prepend('<option class="form-control">Choose your Substation</option>'),$("#feeder").removeAttr("style size").prepend('<option class="form-control">Choose your Feeder</option>')):($(".choose").click(function(t){t.stopPropagation(),$(this).siblings(".dropdown").css("width",$(this).outerWidth(!0)).show()}),$(".dropdown").click(function(t){t.stopPropagation();var o=($(this).val(),$(this).children("option:selected").text().replace(/_1-0/g," ")||"Select options");$(this).siblings(".choose").text(o).css("textTransform","capitalize"),$(this).hide(150)}),$(document).mouseup(function(t){var o=$(".dropdown");o.is(t.target)||0!==o.has(t.target).length||o.hide()})),$("#sub").change(function(t){t.stopPropagation();var o=$(this).val();$("#feeder").empty(),$.ajax({type:"POST",url:"index.php",data:{sub:o},success:function(t){$("#feeder").prepend('<option class="visible-xs visible-sm">Choose your Feeder</option>');var o=$.parseJSON(t);"object"==typeof o&&($.each(o,function(t,o){$.each(o,function(t,o){$("#feeder").append('<option value="'+t+'">'+o+"</option>")})}),$(".feeder").show(300))}})}),$("#feeder").change(function(){var t=$(this).val(),o=moment(window.start,"DD/MM/YYYY").format("YYYY-MM-DD"),e=(window.start.substring(0,2),window.start.substring(3,5)),a=(window.start.substring(6,10),moment(window.end,"DD/MM/YYYY").format("YYYY-MM-DD")),n=(window.end.substring(0,2),window.end.substring(3,5),window.end.substring(6,10),moment(window.start,"DD/MM/YYYY")),r=moment(window.end,"DD/MM/YYYY"),s=r.diff(n,"months");getDetails(t,o,a,s,e),$("#hour_takpa").fadeIn(400)}),$("#dtr").change(function(){var t=$(this).val();""==t||null==t?$("#billing_takpa").hide(100):(load_new=(.75*t).toFixed(2),$("#bill_cal_kva").html("The Contracted Demand  is 'DTR Capacity in KVA X 75%' = "+load_new+" KVA.<br /><br />Billing Demand = Contracted Demand = "+load_new+" KVA."),$("#billing_takpa").fadeIn(1200))}),$(document).ajaxStart(function(){$("#loading").show()}).ajaxStop(function(){$("#loading").hide()}),$("#submit").click(function(){var t="",o=$("#t_loss").val(),e=!1,a=[],n=$("#month").val();""!=n&&null!=n||($("#month").addClass("form-error"),a.push("The Month Field is required!"),e=!0);var r=$("#cat").val();""!=r&&null!=r||($("#cat").addClass("form-error"),a.push("The Category Field is required!"),e=!0);var s=$("#dtr").val();""!=s&&null!=s||($("#dtr").prev(".choose").addClass("form-error"),a.push("The DTR capacity Field is required!"),e=!0);var i=(Math.round(.85*s),$("#sub").val());""!=i&&null!=i||($("#sub").prev("option.choose").addClass("form-error"),a.push("The Substation Field is required!"),e=!0);var d=window.i;if("undefined"==typeof d&&($("#feeder").prev(".choose").addClass("form-error"),a.push("The Feeder Field is required!"),e=!0),e){for(var l=a.length,m="",h=1,u=0;l>u;u++)m+=h+". "+a[u]+"<br />",h++;return $("#modal_alert_words").html(m),$("#modalBasic").modal("show"),!1}$("#month").removeClass("form-error"),$("#sub").prev("option.choose").removeClass("form-error"),$("#dtr").prev(".choose").removeClass("form-error"),$("#cat").removeClass("form-error"),$("#feeder").prev(".choose").removeClass("form-error");var u=0,f=!0,c=moment(window.start,"DD/MM/YYYY").format("YYYY-MM-DD"),p=moment(window.end,"DD/MM/YYYY").format("YYYY-MM-DD"),M=c.substring(8,10),w=c.substring(5,7),Y=c.substring(0,4),v=p.substring(8,10),b=p.substring(5,7),g=p.substring(0,4),D=window.days_no,y=d,_=moment().set({year:Y,month:w-1}).endOf("month").format("DD"),T=_-M+1;moment().set({year:g,month:b-1}).endOf("month").format("DD");if(w==b)""==y||null==y?($("#modal_alert_words").html("There is no interuptions report for this feeder for the month of "+getMonthNames(w)+". So bill cannot be calculated!"),$("#modalBasic").modal("show"),f=!1):t=(730-y)/30*(v-M+1);else{var C=$.parseJSON(y),S=Object.keys(C).length;"object"==typeof C&&(t=0,$.each(C,function(o,e){$.each(e,function(o,e){""==e||null==e?($("#modal_alert_words").html("There is no interuptions report for this feeder for the month of "+getMonthNames(o)+". So bill cannot be calculated! You can calculate the month before or after which have interuption reports."),$("#modalBasic").modal("show"),f=!1):(0==u?(12==o&&(Y=1*Y+1),t+=(730-e)/30*T):u==S-1?t+=(730-e)/30*v:12==o?(t+=(730-e)/30*daysInMonth(o,Y),Y=1*Y+1):t+=(730-e)/30*daysInMonth(o,Y),u++)})}))}var O=t,x=window.start,F=window.end;f&&$.ajax({type:"POST",url:"index.php",data:{days:D,dtr:s,cat:r,totalHour:O,t_loss:o,startPeriod:x,endPeriod:F},success:function(t){$("#modal").html(t),$("#modalLarge").modal("show")}})})});